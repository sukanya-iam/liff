<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover">
    <title>My LIFF app</title>
    <link rel="stylesheet" href="css/style.css" media="all">
</head>
<body>
    <h2 style="color:pink;">Line liff <span id="spVersion"></span></h2>
    <p id="os"><b>OS:</b> </p>
    <p id="language"><b>Language:</b> </p>
    <p id="version"><b>Version:</b> </p>
    <p id="isInClient"><b>isInClient:</b> </p>
    <p id="accessToken"><b>AccessToken:</b> </p>
    <img id="pictureUrl">
    <p id="userId"><b>userId:</b> </p>
    <p id="displayName"><b>displayName:</b> </p>
    <p id="statusMessage"><b>statusMessage:</b> </p>
    <p id="decodedIDToken"><b>email:</b> </p>
    <p id="type"><b>type:</b> </p>
    <p id="viewType"><b>viewType:</b> </p>
    <p id="utouId"><b>utouId:</b> </p>
    <p id="roomId"><b>roomId:</b> </p>
    <p id="groupId"><b>groupId:</b> </p>
    <p id="friendship"><b>isFriendship:</b> </p>
    <p id="scanCode"><b>Code:</b> </p>
    <p id="isLoggedIn"><b>isLoggedIn:</b> </p>
    <p id="universalLink1"><b>Universal Link:</b> </p>
    <p id="universalLink2"><b>Universal Link with Query params:</b> </p>
    <p><a href="liff/path/?param=9">Link to Path</a></p>

    <button id="btnMsg" onclick="sendMsg()">Send Message</button>
    <button id="btnShare" onclick="shareMsg()">Share Target Picker</button>
    <button onclick="openWindow()">Open Window</button>
    <button id="btnScanCode" onclick="scanCode()">Scan Code</button>
    <button id="btnLogOut" onclick="logOut()">Log Out</button>
    <button id="btnClose" onclick="closed()">Close</button>

    <!-- <script src="js/vconsole.min.js"></script> -->
    <!-- <script>
      var vConsole = new VConsole()
      console.log("Hello World!")
    </script> -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        function createUniversalLink() {
        }

        async function shareMsg() {
        }

        function logOut() {
        }

        function closed() {
        }

        async function scanCode() {
        }

        function openWindow() {
        }

        async function getFriendship() {
        }

        async function sendMsg() {
        }

        function getContext() {
            // utou (1-on-1 chat), group, room, none(external browser)
            $("#type").append(liff.getContext().type);
            // compact, tall, full size
            $("#viewType").append(liff.getContext().viewType);
            // for 1-on-1 chat where liff was opened
            $("#utouId").append(liff.getContext().utouId);
            // for room chat where liff was opened
            $("#roomId").append(liff.getContext().roomId);
            // for group chat where liff was opened
            $("#groupId").append(liff.getcontext().groupId);
        }

        async function getuserprofile() {
            //const profile = await liff.getProfile();
            await liff.getProfile().then((profile) => {
                // เอา url property ของ profile ไปใส่เป็นค่าของ src ใน img tag
                //$("#pictureurl").src = profile.pictureUrl;
                $("#userId").append(profile.userId);
                $("#statusMessage").append(profile.statusMessage);
                $("#displayName").append(profile.displayName);
                // email เป็นค่าที่อยู่ใน openId เลยต้องไปตั้งค่า scope ใน console ด้วย
                $("#decodedIDToken").append(liff.getDecodedIDToken().email);
            })
                .catch((err) => {
                    alert("getProfile error : " + err);
                });
        }

        // ดึงค่า Language, version, isInClient, AccessToken มาแสดง
        function getEnvironment() {
            // liff เปิดใน android, ios หรือ web
            $("#os").append(liff.getOS());
            // defualt language ของ client
            $("#language").append(liff.getLanguage());
            // version ของ liff ที่ถกเปิด
            $("#version").append(liff.getVersion());
            // อันนี้เป็นค่าชั่วคราว เพื่อให้เรา access ไปที่หลังบ่านของ LINE ได้
            $("#accessToken").append(liff.getAccessToken());
            // ผู้ใช่เปิด liff จาก LINE หรือ External browser --> จะได้ซ่อน feature แล้วแต่แพล็ตฟอร์มที่เปิดได้
            $("#isInClient").append(liff.isInClient());
            if (liff.isInClient()) {
                // TRUE - ค่าสั่ง liff.init ถ้าเปิดจากแอพ line มันจะ log in ให้อยู่แล้ว
                $("#btnLogOut").css('display', 'none');
            }
            else {
                // FALSE - 3 ปุมนี้ท่าไม่ได้ถ้าเปิดจาก external browser
                $("#btnMsg").css('display', 'none');
                $("#btnScanCode").css('display', 'none');
                $("#btnClose").css('display', 'none');
            }
        }

        async function main() {
            await liff
                .init({
                    liffId: "2004905818-LqwOoRkn", // Use own liffId
                })
                .then(() => {
                    // Start to use liff's api
                    $('#spVersion').text('V23');
                    getEnvironment();
                    //getUserProfile();
                    //getContext();
                    liff.getProfile().then((profile) => {
                        if (profile != null) {
                            $("#displayName").append(profile.displayName);
                            //if(profile.pictureUrl != null){
                            //$("#pictureurl").src = profile.pictureUrl;
                            //}
                            $("#userId").append(profile.userId);
                            $("#statusMessage").append(profile.statusMessage);
                        } else {
                            alert("profile null");
                        }
                    })
                        .catch((err) => {
                            alert("profile error :" + err);
                        });

                })
                .catch((err) => {
                    // Error happens during initialization
                    alert(err.code + ":" + err.message);
                });
        }
        main()
    </script>
</body>
</html>
